name: Image Scanner

on:
  workflow_dispatch:
  push:
    branches:
      - main
    paths:
      - 'images/**/Dockerfile'

jobs:
  ImageScanner:
    runs-on: ubuntu-latest
    # strategy:
    #   matrix:
    #     images: [ nginx ] 
    #outputs:
    #  #format('{0}', matrix.images): ${{ steps.pull.outputs[format('{0}', matrix.images)] }}
    #  SHA: ${{ steps.pull.outputs.SHA }}
    
    steps:        
          # Checkout Repo
          - name: Check out the repository
            uses: actions/checkout@v4
            with:
              fetch-depth: 2
          
          # Pull Latest Images
          - name: Check Changes Files
            id: check
            shell: bash
            run: |
                files=$(git diff-tree --no-commit-id --name-only -r ${{ github.sha }})
                #git show --pretty="" --name-only ${{ github.sha }}
                echo $files
                #git log --name-only -n 1 ${{ github.sha }} #| Where-Object {$_ -CLike "*/Dockerfile"} | ForEach-Object { Write-Host "$_"}
                #git show --stat --name-only ${{ github.sha }}
                
                #git show --name-only ${{ github.sha }} | Where-Object {$_ -CLike "*/Dockerfile"} 
                #| ForEach-Object { Write-Host "$_"}
                
